# 地図画像トポロジーエディタ仕様書

## 概要

このツールは地図画像を読み込ませて、その地図画像に町や村やランドマークといった場所の位置とれらを繋ぐ道を配置するツールです。

## 目的

notebookLMなどのAIツールで、AIが地図情報を容易に扱えるようにするためのデータを作成するのが目的。
データ構造はOpen Street Mapに近い構造にしているので、将来的にルート探査等のライブラリを利用できるようにしています。

## 構成

このツールはGitHub Pagesで使用することを想定しています。


## 概要にBeta3の追記
このツールは地図画像を読み込ませて、その地図画像に町や村やランドマークといった場所の位置とれらを繋ぐ道を配置するツールです。

## 変更履歴
- **v1.0.0**: (2026-02-03)
    - [v1.0.0で変更] GitHub Pagesリンクの(予定)表記を削除
    - [v1.0.0で追加] READMEに詳細な使い方、著作権、免責事項を追記
    - [v1.0.0で変更] 正式リリース版としてドキュメントを整備

- **Beta 3**: (2026-02-03)
    - [Beta3で修正] ズームイン/アウト時にマップ中心がずれる問題を修正
    - [Beta3で追加] Node（ノード）の非表示機能を追加
    - [Beta3で追加] 表示中のマップ範囲のみを画像(png)としてダウンロードする機能を追加（UI/要素非表示対応）

- **Beta 1**: (2026-02-02)
    - [Beta1で追加] 画面右上にバージョン(β1)を表示
    - [Beta1で追加] 画面右側にノード一覧を表示 (クリックで選択)
    - [Beta1で追加] Deleteキーでの要素削除機能
    - [Beta1で追加] 縮尺設定のUI改善（2点クリック入力、リアルタイム縮尺表示）
- **Beta 2**: (2026-02-02)
    - [Beta2で追加] ツールバーボタンのレイアウト修正（英語名削除による省スペース化）
    - [Beta2で追加] ノード/Way種別入力時のオートコンプリート機能
    - [Beta2で追加] ノード一覧（右サイドバー）へのフィルタ機能（種別/名称）
    - [Beta2で追加] 距離計測モードの追加
    - [Beta2で追加] リンク（Way）名称の表示/非表示トグル機能
    - [Beta2で変更] 縮尺のデフォルト単位をmからkmに変更
    - [Beta2で追加] パンモード（ドラッグでの地図移動）の追加
    - [Beta2で追加] 画面上へのズームイン・アウトボタンの配置
    - [Beta2で修正] 計測モードの座標計算ロジックの修正
    - [Beta2で変更] ステータスバーの縮尺表示を「距離 単位」から「単位/px」形式に変更
    - [Beta2で改善] 初期画面のJSON読み込みボタンのUI改善（画像アップロードと同様のボタンスタイル）

## 機能

### 地図のアップロード

ユーザーは地図画像をツールにアップロードできる。
扱える画像の形式はpngとgifは必須で、それ以外は任意とする。
ダウンロードした地図トポロジーデータを読みこめる。

### 編集データのダウンロード

ユーザーは地図画像と地図に配置した情報を、地図トポロジーデータとしてダウンロードできる。

### 編集データの基本設定

地図トポロジーデータで使用する距離の単位はユーザーが指定できる(Km,マイル)。
デフォルトの距離単位はKmとする。
ユーザーは地図の縮尺を定義するために、２点を指定して、その２点間の距離を入力する。
地図の縮尺定義は、地図画像を読み込んだ直後や、編集中にいつでも行うことができる。
単位は `km`, `mile` 以外にも自由入力可能とする。

地図データトポロジーデータには読み込んだ画像のファイル名と、nodeの位置情報、node間の接続関係、縮尺が含まれる。

### 地図の拡大縮小

ユーザーはマウスホイールやボタン操作で地図を拡大縮小できる。

### [Beta2で変更] 検索・フィルタ機能

ユーザーはノード一覧（右サイドバー）からノードを検索・フィルタできる。
- **フィルタ条件**: 「種類（Type）」または「名称（Name）」を選択可能。
- **検索文字列**: 入力された文字列で部分一致フィルタリングを行う。
- フィルタ結果を選択して画面中央にその場所が表示されるように表示範囲を移動する。

### [Beta2で追加] ズームボタンとパンモード
- **ズームボタン**: キャンバス上に配置される[+][-]ボタン。マウスホイールが使えない環境向け。
- **パンモード**: ツールバーから選択可能な「手のひらツール」。選択中はドラッグ操作で地図移動が可能になる（シフトキー不要）。


### [Beta2で変更] 編集・閲覧・計測モード

ユーザーは以下のモードを切り替えられる。
1. **編集モード**: Node/Wayの配置、移動、プロパティ編集が可能。
2. **閲覧モード**: 閲覧のみ（誤操作防止）。ツールバー等は非表示または無効化。
3. **[Beta2で追加] 計測モード**:
    - 地点を選択（クリック）し、マウスカーソル位置までの距離をリアルタイムでステータスバー等に表示する。
    - クリックで始点を固定、再クリックで解除などが可能。

### [Beta2で追加] 表示オプション
- **リンク名称表示**: トグルボタンにより、地図上のWay（リンク）付近への名称表示を切り替えられる。

## 画面構成

### トップバー (#header)

画面上部30pxぐらいの高さのエリアです。
- [Beta2で変更] バージョン番号(β2)を表示。
- [Beta2で追加] リンク名称表示切替ボタンを配置。
- 地図画像のアップロードや縮尺の変更、トポロジーデータのダウンロード機能へのアクセスボタン等を置きます。

### ツールバー (#toolbar)

画面の左側200pxぐらいの幅のエリアです。
- [Beta2で変更] ボタン内のテキストが長すぎてはみ出す問題を解消（英語併記の削除など）。
- [Beta2で追加] モード切替に「パン（手のひら）」モードを追加。
- ユーザーが配置可能なnodeやwayを選択できるエリアです。
- 選択中の要素（Node/Way）のプロパティ編集フォームもここに表示されます。
- [Beta2で追加] 要素の「種別（Type）」入力時に、既存の入力値（Node/Wayそれぞれ別枠）から候補リストを表示して選択可能にする。

### メインキャンバス (#mainCanvas)

上記以外の中央エリアです。
- 地図画像や、配置したノードやリンクを表示するエリアです。
- [Beta1で追加] Deleteキー押下で選択中の要素を削除できます。
- [Beta2で追加] 計測モード時は、計測始点とカーソル間のラバーバンドや距離を表示。
- [Beta2で追加] 画面上にズームイン・ズームアウトボタンを配置。
- [Beta3で追加] 現在の表示範囲を画像としてダウンロードするボタンを配置（ノード・Way・UIを一時的に隠して撮影）。

### [Beta3で追加] ノード・Wayの表示制御
- **Node表示切替**: ツールバー等のスイッチで、全ノードの表示/非表示を切り替え可能にする。
- **Way表示切替**: 既にWay名称の表示切替はあるが、Way自体の描画も非表示にできる機能を（ダウンロード機能等のために）内部的に、あるいはUIとして追加する。


### 右サイドバー (ノード一覧) (#rightSidebar)

画面の右側200pxぐらいの幅のエリアです（ツールバーと同じ幅）。
- [Beta2で追加] 上部にフィルタUI（条件選択ドロップダウン + テキスト入力）を配置。
- 登録されている全ノード（フィルタ適用時は絞り込み後）のリストを表示します。
- リスト内のノードをクリックすると、キャンバス上の該当ノードが選択状態になります。

### ステータスバー (#statusBar)

画面の下部30pxぐらいの高さのエリアです。
- エラー表示や警告を表示します。
- 現在の設定されている縮尺情報を表示します（設定変更時に即時反映）。
- [Beta2で追加] 計測モード時、計測中の距離を表示します。

## nodeについて

ユーザーはnodeを地図に配置できる。
nodeには町、村、集落、やランドマークがある。
nodeには日本語名と英語名を付けることができる。デフォルトは日本語名。
nodeには名前と配置したときに表示する文字と地図上での位置で構成される。
ユーザーは配置するnodeを追加することができる。
nodeはユーザーによって表示/非表示を切り替えることができる。
nodeには実際には場所として存在しないwayの中間座標のためだけのものがあります。
ユーザーはnodeの位置を移動させることができる。
ユーザーはnodeを削除できる。
wayで使用されているnodeが削除された場合、そのwayにつながるnodeが1つ以下になった場合削除してください。

## wayについて

wayには日本語名と英語名を付けることができる。デフォルトは日本語名。
リンクとはnode間の接続状態を表すものです。
一つのリンクには少なくとも２つのnodeに接続されています。
リンクには複数の中間座標が含まれる可能性がある。
ユーザーはWayを構成するNodeを追加・削除・移動でき、接続を維持したまま形状を変更できる。
[Beta1で追加] **Wayの作成**: 編集モード時に始点ノードを選択した状態で、終点ノードを `Shift` キーを押しながらクリックすることで、2点間に新しいWayを作成できる。

## 座標系とデータ構造について

このツールでは：左上原点（Screen Space）とする座標系を用います。
詳細なデータ構造については MapNodeWay仕様書.md を参照してください。

## 技術スタック
* **Frontend Framework**: Vite + React + TypeScript
* **Styling**: TailwindCSS + shadcn/ui
* **Deployment**: GitHub Pages

## コミットユーザーと著作権

このツールはyahabihhagureとしてコミットする。
GitHubリポジトリは以下を使用する。

https://github.com/Yasabihhagure/MapTopologyEditor.git

著作権はyahabihhagureが保持し、MITライセンスとする。
免責事項：本ツール作成されたデータおよび、本ツール使用による損害について、作者は一切責任を負いません。
GitHubへpushする際はREADME.mdを書いてください。
README.mdにpagesのURLリンクを含めてください。
