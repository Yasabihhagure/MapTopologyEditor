# 地図画像トポロジーエディタ仕様書

## 概要

このツールは地図画像を読み込ませて、その地図画像に町や村やランドマークといった場所の位置とれらを繋ぐ道を配置するツールです。

## 目的

notebookLMなどのAIツールで、AIが地図情報を容易に扱えるようにするためのデータを作成するのが目的。
データ構造はOpen Street Mapに近い構造にしているので、将来的にルート探査等のライブラリを利用できるようにしています。

## 構成

このツールはGitHub Pagesで使用することを想定しています。

## 変更履歴
- **Beta 1**: (2026-02-02)
    - [Beta1で追加] 画面右上にバージョン(β1)を表示
    - [Beta1で追加] 画面右側にノード一覧を表示 (クリックで選択)
    - [Beta1で追加] Deleteキーでの要素削除機能
    - [Beta1で追加] 縮尺設定のUI改善（2点クリック入力、リアルタイム縮尺表示）


## 機能

### 地図のアップロード

ユーザーは地図画像をツールにアップロードできる。
扱える画像の形式はpngとgifは必須で、それ以外は任意とする。
ダウンロードした地図トポロジーデータを読みこめる。

### 編集データのダウンロード

ユーザーは地図画像と地図に配置した情報を、地図トポロジーデータとしてダウンロードできる。

### 編集データの基本設定

地図トポロジーデータで使用する距離の単位はユーザーが指定できる(Km,マイル)。
デフォルトの距離単位はKmとする。
ユーザーは地図の縮尺を定義するために、２点を指定して、その２点間の距離を入力する。
地図の縮尺定義は、地図画像を読み込んだ直後や、編集中にいつでも行うことができる。
単位は `km`, `mile` 以外にも自由入力可能とする。

地図データトポロジーデータには読み込んだ画像のファイル名と、nodeの位置情報、node間の接続関係、縮尺が含まれる。

### 地図の拡大縮小

ユーザーはマウスホイールやボタン操作で地図を拡大縮小できる。

### 検索機能

ユーザーはノードの位置を検索できる。
検索は日本語名でも英語名でもできる。
検索した結果複数の場所がある場合リスト表示する。
検索結果が5件以上ある場合は最初の5件のみ表示する。
検索結果を選択して画面中央にその場所が表示されるように表示範囲を移動する。

### 編集モードｔ閲覧モード

ユーザーはnodeやwayを配置できる編集モードと、閲覧のみを目的とした閲覧モードを切り替えられる。
閲覧モードの場合、ツールバーを隠してください。

## 画面構成

### トップバー (#header)

画面上部30pxぐらいの高さのエリアです。
- [Beta1で追加] 右上にバージョン番号(β1)を表示し、右側に配置します。
- 地図画像のアップロードや縮尺の変更、トポロジーデータのダウンロード機能へのアクセスボタン等を置きます。

### ツールバー (#toolbar)

画面の左側200pxぐらいの幅のエリアです。
- ユーザーが配置可能なnodeやwayを選択できるエリアです。
- 選択中の要素（Node/Way）のプロパティ編集フォームもここに表示されます。

### メインキャンバス (#mainCanvas)

上記以外の中央エリアです。
- 地図画像や、配置したノードやリンクを表示するエリアです。
- [Beta1で追加] Deleteキー押下で選択中の要素を削除できます。

### [Beta1で追加] 右サイドバー (ノード一覧) (#rightSidebar)

画面の右側200pxぐらいの幅のエリアです（ツールバーと同じ幅）。
- 登録されている全ノードのリストを表示します。
- リスト内のノードをクリックすると、キャンバス上の該当ノードが選択状態になります。

### ステータスバー (#statusBar)

画面の下部30pxぐらいの高さのエリアです。
- エラー表示や警告を表示します。
- [Beta1で追加] 現在の設定されている縮尺情報を表示します（設定変更時に即時反映）。


## nodeについて

ユーザーはnodeを地図に配置できる。
nodeには町、村、集落、やランドマークがある。
nodeには日本語名と英語名を付けることができる。デフォルトは日本語名。
nodeには名前と配置したときに表示する文字と地図上での位置で構成される。
ユーザーは配置するnodeを追加することができる。
nodeはユーザーによって表示/非表示を切り替えることができる。
nodeには実際には場所として存在しないwayの中間座標のためだけのものがあります。
ユーザーはnodeの位置を移動させることができる。
ユーザーはnodeを削除できる。
wayで使用されているnodeが削除された場合、そのwayにつながるnodeが1つ以下になった場合削除してください。

## wayについて

wayには日本語名と英語名を付けることができる。デフォルトは日本語名。
リンクとはnode間の接続状態を表すものです。
一つのリンクには少なくとも２つのnodeに接続されています。
リンクには複数の中間座標が含まれる可能性がある。
ユーザーはWayを構成するNodeを追加・削除・移動でき、接続を維持したまま形状を変更できる。
[Beta1で追加] **Wayの作成**: 編集モード時に始点ノードを選択した状態で、終点ノードを `Shift` キーを押しながらクリックすることで、2点間に新しいWayを作成できる。

## 座標系とデータ構造について

このツールでは：左上原点（Screen Space）とする座標系を用います。
詳細なデータ構造については MapNodeWay仕様書.md を参照してください。

## 技術スタック
* **Frontend Framework**: Vite + React + TypeScript
* **Styling**: TailwindCSS + shadcn/ui
* **Deployment**: GitHub Pages

## コミットユーザーと著作権

このツールはyahabihhagureとしてコミットする。
GitHubリポジトリは以下を使用する。

https://github.com/Yasabihhagure/MapTopologyEditor.git

著作権はyahabihhagureが保持し、MITライセンスとする。
GitHubへpushする際はREADME.mdを書いてください。
README.mdにpagesのURLリンクを含めてください。
